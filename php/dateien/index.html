<!DOCTYPE html> 
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6 web-development"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7 web-development"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8 web-development"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9 web-development"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js web-development"> <!--<![endif]-->
<head> 

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title>Lehrbuch Web-Development - Dateien und Ordnern in PHP</title>
   
  <meta name="author" content="Brigitte Jellinek"> 
  <meta name="description" content="Ein Lehrbuch für das Informatik- oder Medieninformatik-Studium."> 

  <meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0;">
  <meta name="generator" content="nanoc 3.1.6">

  <link rel="shortcut icon" href="/assets/img/favicon.ico">

  <link rel="stylesheet" href="/assets/css/bootstrap.css?v=1">
  <link rel="stylesheet" href="/assets/css/prettify.css?v=1">
  <link rel="stylesheet" href="/assets/css/style.css?v=1">

  <script src="/assets/js/jquery.js?v=1.7.1"></script>
  <script src="/assets/js/bootstrap.js?v=1"></script>
  <script src="/assets/js/prettify.js?v=1"></script>
  <script src="/assets/js/libs/modernizr-1.5.min.js?v=1"></script>

</head>
<body>

<div class="container">

      <a href="http://github.com/bjelline/web-development-textbook/"><img style="position: fixed; top: 0; right: 0; border: 0;" src="https://a248.e.akamai.net/assets.github.com/img/30f550e0d38ceb6ef5b81500c64d970b7fb0f028/687474703a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6f72616e67655f6666373630302e706e67" alt="Fork me on GitHub"></a>
  <header class="row">
    <div class="jumbotron sub-header span8" id="booktitle">
      <h1><a href="/" title="Web Development">Web Development</a></h1>
      <p class="lead">Ein Lehrbuch für das Informatik oder Medien-Informatik Studium.</p>
    </div>
  </header>
    



	<!-- body -->
	<article id="body" class="row">
		
		<div class="span8">
		
			
                          <div class="page-header">
				<h2 class="title">Dateien und Ordnern in PHP</h2>
                                <a href="/php/dateien/slide.html">als Präsentation</a>
                          </div>
			
			
			<p>In diesem Kapitel wird beschreiben, wie PHP mit Dateien und Ordnern arbeiten kann und welche Web-spezifischen Probleme dabei auftreten.</p>

<h2 id="zugriffsrechte">Zugriffsrechte</h2>
<p>Achtung: Auf einem UNIX-Webserver läuft das PHP-Programm unter dem Account des Webservers, nicht unter Ihrem Account! Dies wird relevant, sobald ein PHP-Programm eine andere Datei  lesen oder (über-)schreiben soll.</p>

<p>Beim Upload der Dateien auf den Webserver mit einem FTP oder SFTP Programm sollten Sie auch die Möglichkeit haben, die Zugriffsrechte anzusehen bzw. zu verändern. Abbildung 133 zeigt links die Darstellung der Zugriffsrechte in der Shell, rechts das Verändern der Zugriffsrechte mit Dreamweaver.</p>

<p><img src="/images/zugriffsrechte-dreamweaver.png" alt="Abbildung 137: UNIX Zugriffsrechte mit Dreamweaver setzen" /></p>

<p>Eine kurze Wiederholung der UNIX-Zugriffsrechte: Es gibt drei Rechte (Lesen, Schreiben, Ausführen) und drei Gruppen von Usern die unterschieden werden (Eigentümer, Gruppe, Andere). Im Terminal werden diese Rechte als Buchstaben angezeigt: r steht für Lesen, w für Schreiben, x für Ausführen.</p>

<p><img src="/images/zugriffsrechte-kommandozeile.png" alt="Abbildung: Darstellung der UNIX Zugriffsrechte in der Kommandozeile" /></p>

<p>Das PHP-Programm läuft nicht unter Ihrem Account, sondern unter dem Account des Webservers. D.h. für das PHP-Programm gelten die Zugriffsrechte „für Alle“. </p>

<p>Mit den PHP-Funktionen is_readable() und is_writable() können Sie testen, ob das Programm Lese- bzw. Schreibrechte auf eine bestimmte Datei hat.</p>

<h2 id="ordner-auflisten">Ordner auflisten</h2>
<p>Um herauszufinden, welche Dateien (und Unter-Ordner) sich in einem Ordner befinden, verwendet man die Funktion <code>glob</code>. (Achtung: die Funktionen <code>opendir</code>, <code>readdir</code>, <code>closedir</code> gibt es auch, die sind aber komplizierter zu verwenden) </p>

<div class="example">
<pre class="lang-php prettyprint linenums">
      &lt;?php
         $alle = glob(&quot;*&quot;);
         foreach( $alle as $file ) {  // forach-Schleife über Werte, Schlüssel ignorieren!
             echo &quot;&lt;br&gt;Datei $file gefunden.\n&quot;;
         } 
      ?&gt; 
</pre></div>

<p>Im Output des Programmes werden nicht nur Dateien angezeigt, sondern auch Ordner. Mit den Funktionen <code>is_dir()</code> und <code>is_file()</code> könnte man herausfinden ob ein Ordner oder eine Datei vorliegt.</p>

<p>Die Funktion glob kann — ähnlich wie das DOS-Kommand dir oder das UNIX-Kommando ls —mit verschiedenen Mustern suchen: </p>

<div class="example">
<pre class="lang-php prettyprint linenums">
      &lt;?php
         $alle = glob(&quot;*.jpg&quot;);
         foreach( $alle as $file ) {
             echo &quot;&lt;br&gt;Bild $file gefunden.\n&quot;;
         } 
      ?&gt;
</pre></div>

<p>Der Rückgabewert von glob ist ein Array. Mit <code>array_merge</code> kann man mehrere Arrays zusammenfügen zu einem langen Array und mit asort die Werte alphabethisch sortieren:</p>

<div class="example">
<pre class="lang-php prettyprint linenums">
         $jpg = glob(&quot;bilder/*.jpg&quot;);
         $gif = glob(&quot;bilder/*.gif&quot;);
         $alle_bilder = array_merge($jpg, $gif);
         asort( $alle_bilder )
</pre></div>

<h2 id="datei-lesen">Datei lesen</h2>
<p>Um eine Datei von PHP aus zu benutzen, muss man sie mit der Funktion <code>fopen</code> öffnen. Man erhält einen „handle“ mit dem man sich im Weiteren auf diese Datei bezeihen kann. </p>

<div class="example">
<pre class="lang-php prettyprint linenums">
      $handle = fopen(&quot;counter.txt&quot;, &quot;r&quot;);    // r steht für read = lesen
</pre></div>

<p>Achtung: die Pfadangabe zur Datei ist in UNIX-Schreibweise mit Slash zu schreiben, nicht in Windows-Schreibweise mit Backslash, also: </p>

<div class="example">
<pre class="lang-php prettyprint linenums">
      # $handle = fopen (&quot;unterordner\counter.txt&quot;, &quot;r&quot;) # FALSCH
        $handle = fopen (&quot;unterordner/counter.txt&quot;, &quot;r&quot;)
</pre></div>

<p>Da die Datei zum Lesen geöffnet wurde, kann man nun mit <code>fgets</code> eine Zeile aus der Datei lesen. „Eine Zeile“ bedeutet hier: bis ein Zeilenumbruch in der Datei gefunden wird. </p>

<div class="example">
<pre class="lang-php prettyprint linenums">
      $zahl = fgets($handle);
</pre></div>

<p>Bei längeren Dateien wird <code>fgets</code> meist in einer Schleife verwendet, um alle Zeilen aus der Datei zu lesen. Nach Gebrauch muss man die Datei wieder schließen:</p>

<div class="example">
<pre class="lang-php prettyprint linenums">
      fclose($handle);
</pre></div>

<h2 id="datei-ber-schreiben">Datei (über-)schreiben</h2>
<p>Beim Schreiben wird als zweites Argument von fopen der Buchstabe „w“ übergeben:</p>

<div class="example">
<pre class="lang-php prettyprint linenums">
      $handle = fopen(&quot;counter.txt&quot;, 'w');
      fwrite($handle, &quot;$zahl\n&quot;);
      fclose($handle);
</pre></div>

<p>Leider ist das Leben aber nicht so einfach:  sowohl beim Lesen als auch beim Schreiben von Dateien kann viel schief gehen. Existiert die Datei, aus der ich lesen will, überhaupt?  Darf ich in die Datei, in die ich schreiben will überhaupt schreiben?  Um diese Fragen zu beantworten gibt es Funktionen <code>is_readable</code>,  <code>is_writable</code> und die Rückgabewerte der verschiedenen schon gezeigten File-Funktionen. So liefert fwrite entweder die Anzahl der geschriebenen Bytes oder FALSE als Status-Code zurück:</p>

<div class="example">
<pre class="lang-php prettyprint linenums">
      $status = fwrite($handle, $zahl);
      if ( $status === FALSE ) {
          echo &quot;Datei nicht schreibbar: Platte voll? Zugriff verboten?&quot;;
          exit;
      }
</pre></div>

<p>Bevor Sie beginnen mit PHP Dateien zu (über-)schreiben, zu löschen oder zu verschieben ein Warnhinweis: Es wird ernst. Hier gibt es keinen Papierkorb. Wenn Ihr PHP-Programm eine Datei löscht, dann ist diese Datei sofort und unwiederbringlich weg.</p>

<h2 id="gleichzeitiger-schreibender-zugriff">Gleichzeitiger schreibender Zugriff</h2>
<p>Achtung: was passiert wenn zwei Zugriffe genau gleichzeitig erfolgen? Zwei Apache-Prozesse führen jeweils das PHP-Programm aus und versuchen, in die gleiche Datei zu schreiben!  Diese Problem existiert, wir werden es aber erst mal ignorieren.</p>

		
			<div class="pagination">
  <ul>
    
      <li><a href="/php/syntax/">← <span class="article">Syntax von PHP</a></li>
    
    
      <li><a href="/php/mail/">PHP und E-Mail →</a></li>
    
  </ul>
</div>

		</div>
		
		<!-- sidebar -->
<div id="sidebar" class="span3 offset1">
        <div class="page-header"> 
        <h2>Kapitel</h2>
        </div>

        
        <ul class="nav nav-list">
        
          
            <li ><a href="/das-web-und-html/">DAS WEB UND HTML</a>
              <ul class="sub">
                
                  
                    
                      
                    
                      
                      <li ><a href="/das-web-und-html/geschichte/">Eine Kurze Geschichte des World Wide Web</a></li>
                      
                    
                      
                      <li ><a href="/das-web-und-html/standards/">Drei Standards definieren das Web</a></li>
                      
                    
                      
                      <li ><a href="/das-web-und-html/html-grundkurs/">HTML Grundkurs</a></li>
                      
                    
                      
                      <li ><a href="/das-web-und-html/upload/">Upload und Tools</a></li>
                      
                    
                  
                
              </ul>
            </li>
          
            <li ><a href="/css/">CSS</a>
              <ul class="sub">
                
                  
                    
                      
                    
                      
                      <li ><a href="/css/css-kurz/">Kurzvorstellung von Stylesheets</a></li>
                      
                    
                      
                      <li ><a href="/css/css/">Syntax von CSS</a></li>
                      
                    
                      
                      <li ><a href="/css/properties/">Wichtige Properties</a></li>
                      
                    
                      
                      <li ><a href="/css/basic-selectors/">CSS Selektoren</a></li>
                      
                    
                      
                      <li ><a href="/css/graceful/">Graceful Degradation</a></li>
                      
                    
                      
                      <li ><a href="/css/image-replacement/">Image Replacement</a></li>
                      
                    
                  
                
              </ul>
            </li>
          
            <li ><a href="/css-layout/">CSS LAYOUT</a>
              <ul class="sub">
                
                  
                    
                      
                    
                      
                      <li ><a href="/css-layout/rahmenbedingungen/">Rahmenbedingungen für Layout</a></li>
                      
                    
                      
                      <li ><a href="/css-layout/layout/">CSS für Layout</a></li>
                      
                    
                      
                      <li ><a href="/css-layout/navigation/">Navigationsmenü</a></li>
                      
                    
                      
                      <li ><a href="/css-layout/interaktion/">CSS für Interaktion</a></li>
                      
                    
                      
                      <li ><a href="/css-layout/selektoren/">CSS Selektoren im Detail</a></li>
                      
                    
                  
                
              </ul>
            </li>
          
            <li ><a href="/urls/">URLS</a>
              <ul class="sub">
                
                  
                    
                      
                    
                      
                      <li ><a href="/urls/absolut-relativ/">Absolute und relative URLs</a></li>
                      
                    
                      
                      <li ><a href="/urls/konfiguration/">Konfiguration</a></li>
                      
                    
                      
                      <li ><a href="/urls/tipps/">Pragmatische Tipps</a></li>
                      
                    
                  
                
              </ul>
            </li>
          
            <li ><a href="/formulare/">FORMULARE</a>
              <ul class="sub">
                
                  
                    
                      
                    
                      
                      <li ><a href="/formulare/form/">Formulare</a></li>
                      
                    
                      
                      <li ><a href="/formulare/interaktion/">Formular als Interaktion</a></li>
                      
                    
                      
                      <li ><a href="/formulare/action/">Daten absenden</a></li>
                      
                    
                      
                      <li ><a href="/formulare/php/">Formular und PHP</a></li>
                      
                    
                      
                      <li ><a href="/formulare/javascript/">Formular und Javascript</a></li>
                      
                    
                  
                
              </ul>
            </li>
          
            <li ><a href="/javascript-dom/">JAVASCRIPT DOM</a>
              <ul class="sub">
                
                  
                    
                      
                    
                      
                      <li ><a href="/javascript-dom/hintergrund/">Hintergründe</a></li>
                      
                    
                      
                      <li ><a href="/javascript-dom/basic-javascript/">Basic Javascript</a></li>
                      
                    
                      
                      <li ><a href="/javascript-dom/dom/">DOM</a></li>
                      
                    
                      
                      <li ><a href="/javascript-dom/canvas/">2D Canvas</a></li>
                      
                    
                  
                
              </ul>
            </li>
          
            <li ><a href="/jquery/">JQUERY</a>
              <ul class="sub">
                
                  
                    
                      
                    
                      
                      <li ><a href="/jquery/unobstrusive/">Unobstrusive Javascript</a></li>
                      
                    
                      
                      <li ><a href="/jquery/graceful/">Graceful Degradation</a></li>
                      
                    
                      
                      <li ><a href="/jquery/schreibweise/">Besondere Javascript-Schreibwesen in jQuery</a></li>
                      
                    
                      
                      <li ><a href="/jquery/selektieren-manipulieren/">Selektieren und Manipulieren mit jQuery</a></li>
                      
                    
                      
                      <li ><a href="/jquery/interaktion/">Interaktion mit jQuery</a></li>
                      
                    
                      
                      <li ><a href="/jquery/formularpruerung/">Formulardaten Prüfen mit jQuery</a></li>
                      
                    
                  
                
              </ul>
            </li>
          
            <li ><a href="/php-vorbereitung/">PHP VORBEREITUNG</a>
              <ul class="sub">
                
                  
                    
                      
                    
                      
                      <li ><a href="/php-vorbereitung/was-ist-php/">Was ist PHP? Was passiert am Webserver?</a></li>
                      
                    
                      
                      <li ><a href="/php-vorbereitung/apache/">Apache</a></li>
                      
                    
                      
                      <li ><a href="/php-vorbereitung/erstes-php-programm/">Das erste PHP-Programm</a></li>
                      
                    
                  
                
              </ul>
            </li>
          
            <li ><a href="/http/">HTTP</a>
              <ul class="sub">
                
                  
                    
                      
                    
                      
                      <li ><a href="/http/tcpip-und-dns/">TCP/IP und DNS</a></li>
                      
                    
                      
                      <li ><a href="/http/http/">HTTP</a></li>
                      
                    
                      
                      <li ><a href="/http/php-erzeugt/">PHP erzeugt nicht nur HTML</a></li>
                      
                    
                      
                      <li ><a href="/http/php-und-parameter/">In PHP Daten aus Web-Formularen verarbeiten</a></li>
                      
                    
                      
                      <li ><a href="/http/datei-upload/">Datei Upload</a></li>
                      
                    
                  
                
              </ul>
            </li>
          
            <li ><a href="/git/">GIT</a>
              <ul class="sub">
                
                  
                    
                      
                    
                      
                      <li ><a href="/git/versionskontrolle/">Versionskontrolle</a></li>
                      
                    
                      
                      <li ><a href="/git/basic-git/">Einfacher Arbeitsablauf in Git</a></li>
                      
                    
                      
                      <li ><a href="/git/git-status/">Status von Git abfragen</a></li>
                      
                    
                  
                
              </ul>
            </li>
          
            <li ><a href="/wordpress/">WORDPRESS</a>
              <ul class="sub">
                
                  
                    
                      
                    
                      
                      <li ><a href="/wordpress/was-ist-wordpress/">Was ist Wordpress</a></li>
                      
                    
                      
                      <li ><a href="/wordpress/installation/">Kurz-Installation von Wordpress</a></li>
                      
                    
                      
                      <li ><a href="/wordpress/security/">Security</a></li>
                      
                    
                      
                      <li ><a href="/wordpress/backend/">Überblick Backend</a></li>
                      
                    
                      
                      <li ><a href="/wordpress/seiten/">Artikel und Seiten</a></li>
                      
                    
                      
                      <li ><a href="/wordpress/multimedia/">Multimedia-Dateien</a></li>
                      
                    
                      
                      <li ><a href="/wordpress/themes-sidesbars-widgets/">Themes, Sidebars und Widgets verwenden</a></li>
                      
                    
                      
                      <li ><a href="/wordpress/plugins/">Plugins verwenden</a></li>
                      
                    
                  
                
              </ul>
            </li>
          
            <li class="active"><a href="/php/">PHP</a>
              <ul class="sub">
                
                  
                    
                      
                    
                      
                      <li ><a href="/php/warnhinweis/">Warnhinweis</a></li>
                      
                    
                      
                      <li ><a href="/php/syntax/">Syntax von PHP</a></li>
                      
                    
                      
                      <li class="active"><a href="/php/dateien/">Dateien und Ordnern in PHP</a></li>
                      
                    
                      
                      <li ><a href="/php/mail/">PHP und E-Mail</a></li>
                      
                    
                  
                
              </ul>
            </li>
          
            <li ><a href="/php-mysql/">PHP MYSQL</a>
              <ul class="sub">
                
                  
                    
                      
                    
                      
                      <li ><a href="/php-mysql/start/">Start mit PHP und MySQL</a></li>
                      
                    
                      
                      <li ><a href="/php-mysql/datenbank-lesen/">Eine lesende Web-Applikation</a></li>
                      
                    
                  
                
              </ul>
            </li>
          
            <li ><a href="/session/">SESSION</a>
              <ul class="sub">
                
                  
                    
                      
                    
                      
                      <li ><a href="/session/session-und-login/">Session und Login</a></li>
                      
                    
                  
                
              </ul>
            </li>
          
            <li ><a href="/php-mysql-2/">PHP MYSQL 2</a>
              <ul class="sub">
                
                  
                    
                      
                    
                      
                      <li ><a href="/php-mysql-2/datenbank-schreiben/">Web-Applikation mit Schreibrecht</a></li>
                      
                    
                      
                      <li ><a href="/php-mysql-2/daten-loeschen/">Löschen</a></li>
                      
                    
                      
                      <li ><a href="/php-mysql-2/daten-einfuegen/">Einfügen</a></li>
                      
                    
                      
                      <li ><a href="/php-mysql-2/daten-editieren/">Daten Bearbeiten</a></li>
                      
                    
                      
                      <li ><a href="/php-mysql-2/fehlerbehandlung/">Fehlerbehandlung</a></li>
                      
                    
                  
                
              </ul>
            </li>
          
            <li ><a href="/security/">SECURITY</a>
              <ul class="sub">
                
                  
                    
                      
                    
                      
                      <li ><a href="/security/a1-injection/">Injection</a></li>
                      
                    
                      
                      <li ><a href="/security/a2-xss/">Cross Site Scripting (XSS)</a></li>
                      
                    
                      
                      <li ><a href="/security/a3-auth/">Authentifizierung und Session-Management</a></li>
                      
                    
                      
                      <li ><a href="/security/a4-referenz/">Unsichere direkte Objektreferenzen</a></li>
                      
                    
                      
                      <li ><a href="/security/a5-csrf/">Cross-Site Request Forgery (CSRF)</a></li>
                      
                    
                      
                      <li ><a href="/security/a6-konfiguration/">Sicherheitsrelevante Fehlkonfiguration</a></li>
                      
                    
                      
                      <li ><a href="/security/a7-krypto/">Kryptografisch unsichere Speicherung</a></li>
                      
                    
                      
                      <li ><a href="/security/a8-url/">Mangelhafter URL-Zugriffsschutz</a></li>
                      
                    
                      
                      <li ><a href="/security/a9-transport/">Unzureichende Absicherung der Transportschicht</a></li>
                      
                    
                      
                      <li ><a href="/security/a10-redirect/">Ungeprüfte Um- und Weiterleitungen</a></li>
                      
                    
                  
                
              </ul>
            </li>
          
            <li ><a href="/svg/">SVG</a>
              <ul class="sub">
                
                  
                    
                      
                    
                      
                      <li ><a href="/svg/was-ist-svg/">Was ist SVG</a></li>
                      
                    
                      
                      <li ><a href="/svg/formen/">Grundformen in SVG</a></li>
                      
                    
                      
                      <li ><a href="/svg/koordinaten/">Koordinaten und Transformationen</a></li>
                      
                    
                      
                      <li ><a href="/svg/js-svg/">Javascript und SVG</a></li>
                      
                    
                  
                
              </ul>
            </li>
          
            <li ><a href="/javascript/">JAVASCRIPT</a>
              <ul class="sub">
                
                  
                    
                      
                    
                      
                      <li ><a href="/javascript/funktionen/">Funktionen und this</a></li>
                      
                    
                      
                      <li ><a href="/javascript/closures/">Funktionen und Closures</a></li>
                      
                    
                      
                      <li ><a href="/javascript/objekte/">Objekte + Prototypen</a></li>
                      
                    
                      
                      <li ><a href="/javascript/event-und-closure/">Events und Closures</a></li>
                      
                    
                      
                      <li ><a href="/javascript/module/">Module</a></li>
                      
                    
                      
                      <li ><a href="/javascript/style/">Stil + Tipps</a></li>
                      
                    
                  
                
              </ul>
            </li>
          
            <li ><a href="/applied-javascript/">APPLIED JAVASCRIPT</a>
              <ul class="sub">
                
                  
                    
                      
                    
                      
                      <li ><a href="/applied-javascript/jquery-vs-plain/">jQuery und reines Javascript</a></li>
                      
                    
                      
                      <li ><a href="/applied-javascript/ajax/">AJAX</a></li>
                      
                    
                      
                      <li ><a href="/applied-javascript/ajax-irrwege/">AJAX Irrwege</a></li>
                      
                    
                      
                      <li ><a href="/applied-javascript/cors/">CORS</a></li>
                      
                    
                  
                
              </ul>
            </li>
          
        
        </ul>

</div>
<!-- sidebar -->

		
	</article>
	<!-- /body -->


  <div class="row">
    <div class="span12" id="legal">
        <p class="copyright">veröffentlicht unter <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/at/deed.de">creative commons by-nc-sa</a> im Jahr 2012 von <a href="#">Brigitte Jellinek</a>.
        <p>Zum Weiterentwickeln dieser Seite: <a href="https://github.com/bjelline/web-development-textbook/fork_select">Projekt forken</a> oder <a href="https://github.com/bjelline/web-development-textbook/blob/master/content/php/dateien.md">kommentar zu dieser seite</a></p>

</p>
    </div>
  </div>

</div> <!-- class="container" -->

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
<script>!window.jQuery && document.write(unescape('%3Cscript src="/assets/js/libs/jquery-1.6.4.min.js"%3E%3C/script%3E'))</script>
<script>
  $(document).ready(function(){
    function save_state(){
      var stored = "";
      $('ul.nav > li').each(function(i,e){
        if( $(e).find("i").attr('class') == 'icon-plus' ) {
          stored += "-";
        }  else {
          stored += "+";
        }
      });
      localStorage.setItem('nav-state', stored);
    }
    $('ul.nav > li > a').prepend("<i class='icon-plus'></i>");

    // init state
    var stored = localStorage.getItem('nav-state');
    if ( stored ) {
      var data = stored.split("");
      $('ul.nav > li').each(function(i,e){
        if( data[i] == "+" ) {
          $(e).find(">ul").show();
          $(e).find("i").removeClass('icon-plus').addClass('icon-minus');
        } else {
          $(e).find(">ul").hide();
        }
      });
    } else {
      $('ul.nav ul.sub').hide();
    }
    $('ul.nav li.active ul.sub').show();
    $('ul.nav li.active i').removeClass('icon-plus').addClass('icon-minus');

    $('ul.nav i').click(function(){
      $this = $(this); 
      $this.toggleClass('icon-plus').toggleClass('icon-minus');
      $this.parent().next('ul').toggle();
      save_state();
      return false;
    });
  });
</script>
</body> 
</html>

